@extends('layouts.app')

@section('content')
<h1>Checkout</h1>
<hr>

@if (session()->has('success_message'))
    <div class="alert alert-success">
        {{ session()->get('success_message') }}
    </div>
@endif

@if(count($errors) > 0)
    <div class="alert alert-danger">
        <ul>
            @foreach ($errors->all() as $error)
                <li>{{ $error }}</li>
            @endforeach
        </ul>
    </div>
@endif

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <h3>Billing Details</h3>
        @if(auth()->user())
          <!--get billing info from billing details-->          
          <table>
            <tbody>
              <tr>
                <td>Email:</td>
                <td>{{$billingDetails->billing_email}}</td>
              </tr>
              <tr>
                <td>Full Name:</td>
                <td>{{$billingDetails->billing_name}}</td>
              </tr>
              <tr>
                <td>Phone Number:</td>
                <td>{{$billingDetails->billing_phone}}</td>
              </tr>
              <tr>
                <td>Country:</td>
                <td>{{$billingDetails->billing_province}}</td>
              </tr>
              <tr>
                <td>Address:</td>
                <td>{{$billingDetails->billing_address}}</td>
              </tr>
              <tr>
                <td>City:</td>
                <td>{{$billingDetails->billing_city}}</td>
              </tr>
            </tbody>
          </table>
        @else
          <!--this user is a guest billing info from billing details-->
          
          <table>
              <tbody>
                <tr>
                  <td>Email:</td>
                  <td><input type="text" name="billing_email"></td>
                </tr>
                <tr>
                  <td>Full Name:</td>
                  <td><input type="text" name="billing_name"></td>
                </tr>
                <tr>
                  <td>Phone Number:</td>
                  <td><input type="text" name="billing_phone"></td>
                </tr>
                <tr>
                  <td>Country:</td>
                  <td><input type="text" name="billing_province"></td>
                </tr>
                <tr>
                  <td>Address:</td>
                  <td><input type="text" name="billing_address"></td>
                </tr>
                <tr>
                  <td>City:</td>
                  <td><input type="text" name="billing_city"></td>
                </tr>
              </tbody>
            </table>
        @endif
    </div>
    <div class="col-md-6">
        <h3>Orders Details</h3>
        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">Product Name</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Price</th>
                    <th scope="col">Total</th>
                </tr>
            </thead>
            <tbody>
        @foreach($products as $product)
            <tr>
                <th scope="row">{{$product['item']->id}}</th>
                <td>{{$product['item']->name}}</td>
                <td>{{$product['qty']}}</td>
                <td>${{$product['item']->current_price}}</td>
                <td>${{$product['price']}}</td>
            </tr>
        @endforeach
        <tr>
            <td colspan="5" style="text-align:right;"><b>Total Price:</b> ${{$totalPrice}}</td>
        </tr>
        </tbody>
        </table>
        <a href="/cart" role="button" class="btn btn-success"> back to cart</a>
      </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <h3>Payment Details</h3>
      <hr>
      @if(auth()->user())
        @if($billingDetails->isBillingIncomplete())
          <!--billing info not completely filled-->
          <p>You must fill all the billing information from your dashboard panel in order to checkout the order. Please fill up the information going to this <a href="/dashboard/billings/">link</a></p>
          @else


          <div class="row">

              <div class="col-md-3 form-group">
                  <label for=""><b>Select Payment Method *<b></label>
                  <select id="togglePaymentMtd" name="payment_method" class="form-control">
                      <option value="">Select a Method</option>
                      <option value="Credit/Debit">Credit/Debit Card</option>
                      <option value="Cash">Cash</option>
                      <option value="Bank Deposit">Bank Deposit</option>
                  </select>
                </div>

                <form class="paypal" action="http://localhost/xicia/ecommerce/ecommerce/upload/cms/payment/paypal/payment_process.php" method="post" id="paypal_form" target="_blank" style="display: none;">
                    <input type="hidden" name="cmd" value="_xclick">
                    <input type="hidden" name="no_note" value="1">
                    <input type="hidden" name="lc" value="UK">
                    <input type="hidden" name="currency_code" value="USD">
                    <input type="hidden" name="bn" value="PP-BuyNowBF:btn_buynow_LG.gif:NonHostedGuest">

                    <input type="hidden" name="final_total" value="112">
                    <div class="col-md-12 form-group">
                        <input type="submit" class="btn btn-primary" value="Pay Now" name="form1">
                    </div>
                </form>

                <form action="payment/stripe/init.php" method="post" id="stripe_form" style="display: none;">
                    <input type="hidden" name="payment" value="posted">
                    <input type="hidden" name="amount" value="112">
                    <div class="col-md-12 form-group">
                        <label for="">Card Number *</label>
                        <input type="text" name="card_number" class="form-control card-number">
                    </div>
                    <div class="col-md-12 form-group">
                        <label for="">CVV *</label>
                        <input type="text" name="card_cvv" class="form-control card-cvc">
                    </div>
                    <div class="col-md-12 form-group">
                        <label for="">Month *</label>
                        <input type="text" name="card_month" class="form-control card-expiry-month">
                    </div>
                    <div class="col-md-12 form-group">
                        <label for="">Year *</label>
                        <input type="text" name="card_year" class="form-control card-expiry-year">
                    </div>
                    <div class="col-md-12 form-group">
                        <input type="submit" class="btn btn-primary" value="Pay Now" name="form2" id="submit-button">
                        <div id="msg-container"></div>
                    </div>
                </form>

                <form action="payment/bank/init.php" method="post" id="bank_form" style="display: none;">
                    <input type="hidden" name="amount" value="112">
                    <div class="col-md-12 form-group">
                        <label for="">Send to this Details</label><br>
                        Bank Name: ABC Bank<br>
Account Number: 1222320234444<br>
Branch Name: NY Branch<br>
Country: USA                                        </div>
                    <div class="col-md-12 form-group">
                        <label for="">Transaction Information <br><span style="font-size:12px;font-weight:normal;">(Include transaction id and other information correctly)</span></label>
                        <textarea name="transaction_info" class="form-control" cols="30" rows="10"></textarea>
                    </div>
                    <div class="col-md-12 form-group">
                        <input type="submit" class="btn btn-primary" value="Pay Now" name="form3">
                    </div>
                </form>
              
                <!--end -->
          </div> 
        @endif
      @else
          <p>guest payment method</p>
      @endif
    </div>
  </div>
</div>
@endsection
@section('scripts')
<script>
  $(document).ready(function(){
    $('#togglePaymentMtd').on('change',function() {
      let togglePaymentMtd = $('#togglePaymentMtd').val();
  
      if ( togglePaymentMtd == '' ) {
        $('#paypal_form').hide();
        $('#stripe_form').hide();
        $('#bank_form').hide();
      } else if ( togglePaymentMtd == 'Cash' ) {
        $('#paypal_form').show();
        $('#stripe_form').hide();
        $('#bank_form').hide();
      } else if ( togglePaymentMtd == 'Credit/Debit' ) {
        $('#paypal_form').hide();
        $('#stripe_form').show();
        $('#bank_form').hide();
      } else if ( togglePaymentMtd == 'Bank Deposit' ) {
        $('#paypal_form').hide();
        $('#stripe_form').hide();
        $('#bank_form').show();
      }
    });
  });
</script>
@endsection
